from spectral_film_lut.film_spectral import *


class Kodak5248(FilmSpectral):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

        self.iso = 25
        self.density_measure = 'status_m'
        self.exposure_kelvin = 3200
        self.projection_kelvin = None

        # spectral sensitivity TODO: check y-scale
        red_log_sensitivity = {585.2083: 0.6438, 598.0150: 1.0564, 614.1450: 1.5816, 620.1764: 1.7566, 625.6690: 1.8659,
                               632.3663: 1.9409, 638.3092: 1.9720, 642.4869: 2.0107, 645.7696: 2.0750, 647.9819: 2.1158,
                               651.9298: 2.1415, 656.1539: 2.0974, 664.1854: 1.8470, 670.0089: 1.6084}
        green_log_sensitivity = {493.7973: 1.3787, 502.0131: 1.5838, 508.8382: 1.7929, 514.1517: 1.9799,
                                 518.6949: 2.0914, 524.0412: 2.1597, 530.3220: 2.1922, 539.9681: 2.2024,
                                 546.2446: 2.1823, 550.8762: 2.1364, 558.2054: 1.9907, 567.3362: 1.7125,
                                 576.0673: 1.3621, 582.6091: 0.9904, 586.6851: 0.7279, 589.4758: 0.4623}
        blue_log_sensitivity = {400.6963: 2.9515, 404.1591: 3.1174, 408.6587: 3.2461, 414.5456: 3.3167,
                                420.8155: 3.3083, 427.6576: 3.1858, 432.1265: 3.0677, 437.6149: 3.0037,
                                443.0099: 2.9853, 450.7815: 3.0167, 457.7157: 3.0316, 463.5052: 2.9742,
                                467.6693: 2.8560, 472.1829: 2.5982, 477.6267: 2.2520, 483.3543: 1.9431,
                                491.9172: 1.6508, 500.2742: 1.4238, 505.2799: 1.2545, 508.2920: 1.0169}
        self.log_sensitivity = [red_log_sensitivity, green_log_sensitivity, blue_log_sensitivity]

        # sensiometry - characteristic curve TODO check x and y scale
        red_curve = {0.1315: 0.1994, 0.3396: 0.1904, 0.5432: 0.2103, 0.7554: 0.2704, 1.0243: 0.3917, 1.3192: 0.5769,
                     1.6840: 0.8277, 2.0073: 1.0419, 2.2634: 1.2127, 2.4635: 1.3353, 2.6715: 1.4541, 2.8158: 1.5243,
                     2.9076: 1.5665, 2.9881: 1.5862}
        green_curve = {0.1607: 0.6101, 0.3600: 0.6011, 0.5111: 0.6158, 0.7014: 0.6618, 0.8676: 0.7162, 1.0403: 0.8145,
                       1.2566: 0.9525, 1.4969: 1.1116, 1.7791: 1.3099, 2.0058: 1.4764, 2.2212: 1.6233, 2.5542: 1.8250,
                       2.7486: 1.9377, 2.8601: 2.0056, 2.9899: 2.0758}
        blue_curve = {0.0894: 1.0912, 0.1984: 1.1049, 0.3240: 1.1322, 0.4565: 1.1730, 0.5855: 1.2315, 0.7079: 1.2970,
                      0.8346: 1.3812, 1.0486: 1.5426, 1.2473: 1.7081, 1.5093: 1.9092, 1.8458: 2.1202, 2.0577: 2.2577,
                      2.2914: 2.4266, 2.5229: 2.6020, 2.6801: 2.7259, 2.8068: 2.8311}
        red_log_exposure = xp.array(list(red_curve.keys()), dtype=default_dtype) - 2.45
        red_density_curve = xp.array(list(red_curve.values()), dtype=default_dtype) * 0.91
        green_log_exposure = xp.array(list(green_curve.keys()), dtype=default_dtype) - 2.45
        green_density_curve = xp.array(list(green_curve.values()), dtype=default_dtype) * 0.91
        blue_log_exposure = xp.array(list(blue_curve.keys()), dtype=default_dtype) - 2.45
        blue_density_curve = xp.array(list(blue_curve.values()), dtype=default_dtype) * 0.91
        self.log_exposure = [red_log_exposure, green_log_exposure, blue_log_exposure]
        self.density_curve = [red_density_curve, green_density_curve, blue_density_curve]

        self.exposure_base = 10

        # spectral dye density
        red_sd = {399.4070: 0.7323, 411.7892: 0.6333, 426.5796: 0.5183, 448.7547: 0.3986, 469.7070: 0.3525,
                  511.7797: 0.3644, 549.1127: 0.4355, 575.1442: 0.5336, 605.3495: 0.7214, 623.8621: 0.8866,
                  640.7586: 1.0790, 661.3007: 1.3050, 677.2919: 1.4430, 689.4718: 1.5123, 699.2789: 1.5426}
        green_sd = {399.1273: 0.4362, 416.4663: 0.5255, 428.6542: 0.5823, 436.4000: 0.6010, 445.8159: 0.5817,
                    457.5810: 0.5649, 473.3038: 0.6084, 489.2599: 0.7278, 504.6857: 0.9406, 515.2747: 1.1441,
                    524.7254: 1.2899, 533.4517: 1.3925, 539.7233: 1.4371, 544.6986: 1.4503, 551.8167: 1.4217,
                    560.6235: 1.3258, 570.3292: 1.1482, 579.8472: 0.8971, 595.3940: 0.5563, 609.8700: 0.3453,
                    629.4331: 0.1929, 656.9941: 0.1059, 682.4027: 0.0760, 699.1432: 0.0724}
        blue_sd = {400.2438: 0.8934, 411.4059: 1.0831, 420.4386: 1.2209, 429.9414: 1.3588, 436.9823: 1.4501,
                   441.2412: 1.4806, 446.6337: 1.5031, 452.5139: 1.4984, 456.8631: 1.4617, 465.7438: 1.3241,
                   479.2939: 1.0907, 491.1994: 0.8555, 505.9579: 0.5708, 520.9418: 0.3742, 535.2278: 0.2393,
                   558.0085: 0.1283, 583.6656: 0.0775, 623.6417: 0.0596, 659.8479: 0.0551, 699.3432: 0.0538}
        self.spectral_density = [colour.SpectralDistribution(x) for x in (red_sd, green_sd, blue_sd)]

        self.mtf = [{2.5169: 1.1185, 3.5699: 1.0780, 6.3431: 1.0585, 10.1089: 1.0052, 14.5014: 0.9616, 18.7989: 0.8929,
                     22.3525: 0.8321, 26.0857: 0.7612, 31.8541: 0.6611, 38.2475: 0.5699, 45.2434: 0.4823,
                     57.4047: 0.3610, 65.7731: 0.3032, 77.9868: 0.2330}]

        # copied from kodak exr 5248
        red_rms = {0.0081: 0.0074, 0.5625: 0.0078, 1.2141: 0.0083, 1.4852: 0.0084, 1.9061: 0.0075, 2.2541: 0.0065,
                   2.7357: 0.0054, 3.1364: 0.0047, 3.6301: 0.0044, 4.0753: 0.0044, 4.5326: 0.0044, 4.9939: 0.0044}
        green_rms = {0.0121: 0.0086, 0.6151: 0.0093, 1.0643: 0.0103, 1.3395: 0.0115, 1.4852: 0.0117, 1.7159: 0.0104,
                     1.9547: 0.0083, 2.1773: 0.0068, 2.4444: 0.0061, 2.6993: 0.0061, 3.0554: 0.0065, 3.3144: 0.0063,
                     3.6463: 0.0060, 4.0550: 0.0059, 4.5245: 0.0059, 4.9980: 0.0063}
        blue_rms = {0.0202: 0.0111, 0.3399: 0.0091, 0.5868: 0.0094, 0.7770: 0.0113, 1.0279: 0.0157, 1.2546: 0.0190,
                    1.5217: 0.0201, 1.8495: 0.0180, 2.1327: 0.0153, 2.4605: 0.0134, 2.7398: 0.0130, 3.0231: 0.0129,
                    3.2821: 0.0122, 3.5208: 0.0115, 3.9417: 0.0113, 4.5892: 0.0112, 4.9960: 0.0112}
        red_rms_density = {0.0182: 0.2203, 0.4518: 0.2284, 0.7840: 0.2382, 0.9542: 0.2495, 1.1933: 0.2835,
                           1.5904: 0.3791, 2.4048: 0.6221, 3.4704: 0.9332, 4.1917: 1.1373, 5.0041: 1.3625}
        green_rms_density = {0.0122: 0.6237, 0.5166: 0.6189, 0.9988: 0.6529, 1.4972: 0.7647, 2.0199: 0.9883,
                             3.5069: 1.5326, 4.0174: 1.7173, 4.4854: 1.8566, 5.0020: 2.0608}
        blue_rms_density = {0.0162: 1.0239, 0.6179: 1.0304, 0.9947: 1.0595, 1.3169: 1.1260, 1.7545: 1.2847,
                            2.7087: 1.6671, 3.6244: 2.0381, 4.4246: 2.3248, 5.0000: 2.5095}
        self.rms_curve = [red_rms, green_rms, blue_rms]
        self.rms_density = [red_rms_density, green_rms_density, blue_rms_density]
        # guessed
        self.rms = 5

        self.calibrate()
