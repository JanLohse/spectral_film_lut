import colour.algebra
from spectral_film_lut.film_spectral import *


class Kodak5383(FilmSpectral):
    def __init__(self):
        super().__init__()

        self.lad = [1.08, 1.04, 1.03]
        self.density_measure = 'status_a'
        self.exposure_kelvin = 2854
        self.projection_kelvin = 6500

        # spectral sensitivity
        red_log_sensitivity = {354.5344: -0.9133, 361.2592: -1.0027, 371.4311: -1.0373, 386.4388: -1.0976,
                               400.6495: -1.2384, 420.0954: -1.5064, 428.6481: -1.7314, 434.1496: -2.1170,
                               444.7820: -2.4670, 462.6645: -2.8598, 488.1769: -3.1347, 514.8028: -3.2424,
                               536.6811: -3.2207, 566.0038: -3.0133, 598.8995: -2.6030, 616.5878: -2.3673,
                               629.8324: -2.2158, 653.2614: -2.0842, 678.8853: -1.9421, 693.8102: -1.8141,
                               711.3834: -1.7138, 728.8935: -1.6876, 743.8778: -1.7754, 757.0415: -2.0050,
                               772.0474: -2.3531, 784.9538: -2.5996, 794.0354: -2.7738, 800.8034: -2.8124}
        green_log_sensitivity = {353.7644: -0.1048, 359.4962: -0.2195, 364.2601: -0.3299, 382.6571: -0.4032,
                                 401.0237: -0.5125, 413.2554: -0.6954, 423.9454: -0.9776, 439.5611: -1.4655,
                                 444.8180: -1.5675, 452.5467: -1.6188, 459.8400: -1.6109, 469.1519: -1.5142,
                                 499.5163: -1.2244, 524.4871: -0.9934, 548.7204: -0.7729, 563.6417: -0.6491,
                                 574.8606: -0.5949, 584.0897: -0.5956, 592.2898: -0.6639, 598.8779: -0.9141,
                                 605.6261: -1.2617, 619.7217: -2.1093, 630.8830: -2.6942, 637.9101: -2.9995,
                                 641.1808: -3.1521, 649.3125: -3.3008, 658.4841: -3.3692}
        blue_log_sensitivity = {354.2537: 1.0423, 360.9714: 0.9444, 366.7679: 0.9059, 376.5188: 0.9475,
                                390.1448: 0.9762, 405.6706: 0.9539, 420.1566: 0.8512, 432.4297: 0.7170,
                                455.2165: 0.3788, 469.5261: 0.0688, 485.1455: -0.4149, 497.1326: -0.8856,
                                511.4584: -1.4623, 521.1427: -1.7847, 529.1449: -2.0858, 534.3999: -2.4756,
                                539.9842: -2.7638, 549.5227: -2.9719, 575.0585: -3.2193, 600.2218: -3.3333,
                                629.2999: -3.4137, 653.5025: -3.5149, 661.2222: -3.5768}
        self.log_sensitivity = [red_log_sensitivity, green_log_sensitivity, blue_log_sensitivity]

        # sensiometry
        red_curve = {0.0874: 0.0967, 0.6854: 0.0988, 0.8995: 0.0925, 1.0714: 0.1293, 1.2312: 0.1784, 1.3366: 0.2463,
                     1.4503: 0.3466, 1.5214: 0.4351, 1.6131: 0.5843, 1.7009: 0.7741, 1.7686: 0.9803, 1.8466: 1.2188,
                     1.9388: 1.4775, 2.0315: 1.8255, 2.1180: 2.1572, 2.2025: 2.4809, 2.2787: 2.7682, 2.3485: 2.9947,
                     2.4100: 3.1766, 2.5000: 3.4029, 2.5858: 3.5886, 2.6694: 3.7419, 2.7610: 3.8749, 2.8322: 3.9634,
                     2.9052: 4.0316, 2.9782: 4.0816, 3.0470: 4.1093}
        green_curve = {0.0753: 0.0968, 0.5238: 0.1004, 0.8995: 0.0966, 1.0127: 0.1157, 1.1180: 0.1552, 1.2071: 0.2030,
                       1.2680: 0.2511, 1.3451: 0.3274, 1.4041: 0.3978, 1.4468: 0.4602, 1.5201: 0.5771, 1.5773: 0.6982,
                       1.6428: 0.8720, 1.7330: 1.1348, 1.8398: 1.4704, 1.9364: 1.8102, 2.0372: 2.1581, 2.1362: 2.5587,
                       2.2187: 2.8946, 2.2972: 3.2386, 2.3777: 3.5826, 2.4499: 3.8740, 2.5361: 4.1408, 2.6078: 4.3470,
                       2.6712: 4.5005, 2.7467: 4.6499, 2.8404: 4.7990, 2.9258: 4.9036, 2.9826: 4.9517, 3.0252: 4.9797}
        blue_curve = {0.0874: 0.1008, 0.5319: 0.1023, 0.7016: 0.1168, 0.8432: 0.1499, 0.9647: 0.1994, 1.0640: 0.2592,
                      1.1552: 0.3212, 1.2404: 0.3994, 1.3258: 0.5020, 1.4032: 0.6229, 1.4928: 0.7762, 1.5827: 0.9700,
                      1.6688: 1.2085, 1.7878: 1.5724, 1.9237: 2.0821, 2.0738: 2.6121, 2.1585: 2.9722, 2.2635: 3.3647,
                      2.3518: 3.6518, 2.4481: 3.9227, 2.5382: 4.1570, 2.6423: 4.3669, 2.7279: 4.5243, 2.8053: 4.6371,
                      2.8846: 4.7458, 2.9598: 4.8302, 3.0491: 4.9105}
        red_log_exposure = xp.array(list(red_curve.keys()), dtype=default_dtype)
        red_density_curve = xp.array(list(red_curve.values()), dtype=default_dtype)
        green_log_exposure = xp.array(list(green_curve.keys()), dtype=default_dtype)
        green_density_curve = xp.array(list(green_curve.values()), dtype=default_dtype)
        blue_log_exposure = xp.array(list(blue_curve.keys()), dtype=default_dtype)
        blue_density_curve = xp.array(list(blue_curve.values()), dtype=default_dtype)
        self.log_exposure = [red_log_exposure, green_log_exposure, blue_log_exposure]
        self.density_curve = [red_density_curve, green_density_curve, blue_density_curve]

        # spectral dye density
        midscale_sd = {360.0110: 0.7179, 364.4635: 0.6818, 369.3143: 0.6574, 375.3801: 0.6614, 380.4902: 0.6938,
                       392.6587: 0.8310, 405.8648: 0.9838, 419.1107: 1.1236, 430.0920: 1.2233, 435.6006: 1.2674,
                       439.0259: 1.2829, 443.1361: 1.2876, 448.8333: 1.2703, 462.2290: 1.2202, 474.3222: 1.1701,
                       483.3369: 1.1329, 491.6210: 1.1214, 499.8593: 1.1249, 508.4842: 1.1438, 518.8197: 1.1712,
                       530.0711: 1.1831, 540.3365: 1.1626, 548.0925: 1.1111, 560.0839: 1.0236, 577.8897: 0.8806,
                       583.6644: 0.8381, 590.6520: 0.8247, 596.7297: 0.8249, 605.1296: 0.8464, 614.5333: 0.8944,
                       625.6377: 0.9541, 635.0375: 1.0034, 642.3440: 1.0275, 649.9134: 1.0367, 661.8875: 1.0254,
                       670.9439: 0.9745, 689.1440: 0.8445, 703.9149: 0.7002, 720.0795: 0.5262, 727.4769: 0.4502,
                       736.6604: 0.3580}
        red_sd = {359.3458: 0.2283, 366.4632: 0.2433, 377.4916: 0.2572, 387.9085: 0.2581, 397.5088: 0.2421,
                  404.5382: 0.2152, 417.7485: 0.1548, 430.2819: 0.1028, 445.4239: 0.0495, 464.6166: 0.0203,
                  482.4295: 0.0162, 500.1789: 0.0327, 520.0253: 0.0732, 537.2075: 0.1331, 549.1921: 0.1889,
                  567.3086: 0.2978, 586.9948: 0.4610, 601.6687: 0.6306, 615.1237: 0.7730, 624.4083: 0.8598,
                  631.1794: 0.9168, 637.5642: 0.9583, 644.8568: 0.9868, 654.3698: 0.9993, 665.7066: 0.9835,
                  678.0964: 0.9075, 700.6233: 0.7117, 716.0930: 0.5519, 736.2322: 0.3561}
        green_sd = {360.6589: 0.0837, 371.0997: 0.0768, 386.2801: 0.0817, 399.6902: 0.0975, 408.2932: 0.1235,
                    410.8582: 0.1365, 416.0478: 0.1431, 428.0920: 0.1796, 435.8148: 0.2095, 439.6782: 0.2238,
                    447.0722: 0.2194, 454.0201: 0.2189, 462.6390: 0.2398, 469.8244: 0.3033, 488.4041: 0.5440,
                    502.7100: 0.7626, 508.9517: 0.8506, 514.1955: 0.9101, 518.6267: 0.9516, 523.3127: 0.9807,
                    527.8193: 0.9976, 534.5363: 1.0017, 541.3506: 0.9741, 548.7320: 0.9032, 566.3182: 0.6905,
                    576.3852: 0.5228, 591.4620: 0.2790, 605.6915: 0.1696, 632.0685: 0.0630, 654.3278: 0.0247,
                    678.0133: 0.0169, 691.2639: 0.0140, 701.6908: 0.0117, 720.7842: 0.0147, 730.7849: 0.0098,
                    738.8281: 0.0061}
        blue_sd = {359.2954: 0.3859, 365.0740: 0.3421, 369.9129: 0.3216, 374.2640: 0.3184, 378.9897: 0.3347,
                   384.8728: 0.3981, 396.1294: 0.5495, 410.3414: 0.7281, 419.1521: 0.8278, 429.5021: 0.9210,
                   435.4407: 0.9664, 439.5033: 0.9865, 443.3687: 1.0002, 448.1321: 1.0041, 454.6757: 0.9940,
                   459.5305: 0.9682, 471.8661: 0.8394, 486.6860: 0.6085, 503.3497: 0.3428, 510.6214: 0.2371,
                   519.3569: 0.1494, 529.9684: 0.0870, 545.3335: 0.0319, 558.8608: 0.0096, 579.7066: 0.0075,
                   608.8026: 0.0049, 656.5580: 0.0054}
        self.spectral_density = [colour.SpectralDistribution(x) for x in (red_sd, green_sd, blue_sd)]
        self.d_ref_sd = colour.SpectralDistribution(midscale_sd)

        self.calibrate()